var shioharaApp=angular.module("shioharaApp","ngCookies ngResource ngAnimate ngSanitize ui.router ui.bootstrap pascalprecht.translate vecchioOauth angularMoment ui.ace ngFileUpload ui-notification ui.tinymce".split(" "));
shioharaApp.config(["$stateProvider","$urlRouterProvider","TokenProvider","$locationProvider","$translateProvider","NotificationProvider",function(a,b,d,f,e,c){c.setOptions({delay:5E3,startTop:20,startRight:10,verticalSpacing:20,horizontalSpacing:20,positionX:"right",positionY:"bottom"});d.extendConfig({clientId:"b0ec29dd6e0c6bd98b37fee1799dc0a8",redirectUri:"http://localhost:8080/oauth2callback.html",scopes:["https://www.googleapis.com/auth/userinfo.email"]});e.useSanitizeValueStrategy("escaped");
e.translations("en",{SEARCH:"Search",SEARCH_FOR:"Search for"});e.translations("pt",{SEARCH:"Pesquisar",SEARCH_FOR:"Pesquisar por"});e.fallbackLanguage("en");b.otherwise("/content");a.state("oauth2",{url:"/oauth2",templateUrl:"template/oauth2.html",controller:"ShOAuth2Ctrl",data:{pageTitle:"OAuth2 | Viglet Shiohara"}}).state("content",{url:"/content",templateUrl:"template/content.html",controller:"ShContentCtrl",data:{pageTitle:"Content | Viglet Shiohara"}}).state("content.children",{url:"/list",templateUrl:"template/content/content-children.html",
controller:"ShContentChildrenCtrl",data:{pageTitle:"Content | Viglet Shiohara"}}).state("content.children.site-children",{url:"/site/:siteId",templateUrl:"template/channel/channel-children.html",controller:"ShSiteChildrenCtrl",data:{pageTitle:"Content | Viglet Shiohara"}}).state("content.children.channel-children",{url:"/channel/:channelId",templateUrl:"template/channel/channel-children.html",controller:"ShChannelChildrenCtrl",data:{pageTitle:"Content | Viglet Shiohara"}}).state("content.post-type-editor",
{url:"/post/type/editor",templateUrl:"template/post/type/editor.html",controller:"ShPostTypeEditorCtrl",data:{pageTitle:"Post Type Editor | Viglet Shiohara"}}).state("content.post-type-item",{url:"/post/type/:postTypeId",templateUrl:"template/post/type/item.html",controller:"ShPostTypeItemCtrl",data:{pageTitle:"Post Type Editor | Viglet Shiohara"}}).state("content.post-type-item.attribute",{url:"/attrib/:postTypeAttrId",templateUrl:"template/post/type/attribute.html",controller:"ShPostTypeAttrCtrl",
data:{pageTitle:"Post Type Editor | Viglet Shiohara"}}).state("content.post-type-item.post-item-new",{url:"/channel/:channelId",templateUrl:"template/post/item.html",controller:"ShPostNewCtrl",data:{pageTitle:"New Post | Viglet Shiohara"}}).state("content.post-type-item.post-item",{url:"/post/:postId",templateUrl:"template/post/item.html",controller:"ShPostEditCtrl",data:{pageTitle:"Edit Post | Viglet Shiohara"}}).state("post-item-form",{url:"/post/type/:postTypeId/post/form",templateUrl:"template/post/form.html",
controller:"ShPostFormCtrl",data:{}}).state("content.channel",{url:"/channel/:channelId"}).state("content.channel.edit",{url:"/edit",templateUrl:"template/channel/channel-edit.html",controller:"ShChannelEditCtrl",data:{pageTitle:"Edit Channel | Viglet Shiohara"}}).state("content.site",{url:"/site/:siteId"}).state("content.site.edit",{url:"/edit",templateUrl:"template/site/site-edit.html",controller:"ShSiteEditCtrl",data:{pageTitle:"Edit Site | Viglet Shiohara"}}).state("content.channel.channel-new",
{url:"/channel",templateUrl:"template/channel/channel-new.html",controller:"ShChannelNewCtrl",data:{pageTitle:"New Channel | Viglet Shiohara"}}).state("content.site.channel-new",{url:"/channel",templateUrl:"template/channel/channel-new.html",controller:"ShChannelNewCtrl",data:{pageTitle:"New Channel | Viglet Shiohara"}}).state("content.channel.post-type-select",{url:"/post/type",templateUrl:"template/post/type/select-with-channel.html",controller:"ShPostTypeSelectWithChannelCtrl",data:{pageTitle:"Post Type Selection | Viglet Shiohara"}}).state("content.post-type-select",
{url:"/post/type",templateUrl:"template/post/type/select.html",controller:"ShPostTypeSelectCtrl",data:{pageTitle:"Post Type Selection | Viglet Shiohara"}}).state("content.site.post-type-select",{url:"/post/type",templateUrl:"template/post/type/select.html",controller:"ShPostTypeSelectCtrl",data:{pageTitle:"Post Type Selection | Viglet Shiohara"}}).state("content.site-new",{url:"/site/new",templateUrl:"template/site/site-new.html",controller:"ShSiteNewCtrl",data:{pageTitle:"New Site | Viglet Shiohara"}})}]);
shioharaApp.directive("fileread",[function(){return{scope:{fileread:"\x3d"},link:function(a,b,d){b.bind("change",function(b){var e=new FileReader;e.onload=function(c){a.$apply(function(){a.fileread=c.target.result})};e.readAsDataURL(b.target.files[0])})}}}]);
shioharaApp.factory("vigLocale",["$window",function(a){return{getLocale:function(){var b=a.navigator;return angular.isArray(b.languages)&&0<b.languages.length?b.languages[0].split("-").join("_"):(b.language||b.browserLanguage||b.systemLanguage||b.userLanguage||"").split("-").join("_")}}}]);
shioharaApp.service("shAPIServerService",["$http","$location","$cookies",function(a,b,d){var f=b.protocol(),e=b.host();b=b.port();var c=f+"://"+e+":"+b,h=c+"/api";console.log(c);this.server=function(){if(null!=d.get("shServer"))return d.get("shServer");a({method:"GET",url:h}).then(function(a){d.put("shServer",c)},function(a){d.put("shServer","http://localhost:2710")});return c};this.get=function(){if(null!=d.get("shAPIServer"))return d.get("shAPIServer");a({method:"GET",url:h}).then(function(a){d.put("shAPIServer",
h)},function(a){d.put("shAPIServer","http://localhost:2710/api")});return h}}]);
shioharaApp.factory("shChannelFactory",["$uibModal","shChannelResource","Notification","$filter",function(a,b,d,f){return{deleteFromList:function(a,c){this.modalDelete(a).result.then(function(h){deletedMessage="The "+a.name+" Channel was deleted.";b["delete"]({id:a.id},function(){var b=f("filter")(c,{id:a.id},!0)[0],b=c.indexOf(b);c.splice(b,1);d.error(deletedMessage)})},function(){})},modalDelete:function(b){return a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"template/modal/shDeleteObject.html",
controller:"ShModalDeleteObjectCtrl",controllerAs:"$ctrl",size:null,appendTo:void 0,resolve:{shObject:function(){return b}}})}}}]);shioharaApp.factory("shChannelResource",["$resource","shAPIServerService",function(a,b){return a(b.get().concat("/channel/:id"),{id:"@id"},{update:{method:"PUT"}})}]);
shioharaApp.controller("ShChannelChildrenCtrl",["$scope","$state","$stateParams","$rootScope","$translate","$http","shAPIServerService","vigLocale","shChannelFactory","shPostFactory","ShDialogSelectObject",function(a,b,d,f,e,c,h,g,k,m,l){a.siteId=d.siteId;a.channelId=d.channelId;a.$parent.channelId=d.channelId;a.vigLanguage=g.getLocale().substring(0,2);e.use(a.vigLanguage);a.shSite=null;a.shChannels=null;a.shPosts=null;a.breadcrumb=null;f.$state=b;a.shStateObjects=[];a.shObjects=[];a.$watch("$scope.shObjects",
function(){console.log("modificou shObjects")});a.$evalAsync(c.get(h.get().concat("/channel/"+a.channelId+"/list")).then(function(b){a.processResponse(b)}));a.processResponse=function(b){a.shChannels=b.data.shChannels;a.shPosts=b.data.shPosts;a.breadcrumb=b.data.breadcrumb;a.$parent.breadcrumb=b.data.breadcrumb;a.shSite=b.data.shSite;a.$parent.shSite=a.shSite;angular.forEach(a.shChannels,function(b,c){a.shStateObjects[b.shGlobalId.id]=!1;a.shObjects[b.shGlobalId.id]=b});angular.forEach(a.shPosts,
function(b,c){a.shStateObjects[b.shGlobalId.id]=!1;a.shObjects[b.shGlobalId.id]=b})};a.objectsCopy=function(){for(var b in a.shStateObjects)!0===a.shStateObjects[b]&&console.log("Copy "+b)};a.objectsMove=function(){for(var b in a.shStateObjects)!0===a.shStateObjects[b]&&(console.log("Move "+b),l.dialog(a.channelId,"shChannel").result.then(function(a){c.post(h.get().concat("/reference/to/"+shObject.shGlobalId.id+"/replace/"+a.shGlobalId.id)).then(function(a){$ctrl.objectRefers=a.data})},function(){}))};
a.objectsClone=function(){for(var b in a.shStateObjects)!0===a.shStateObjects[b]&&console.log("Clone "+b)};a.objectsRename=function(){for(var b in a.shStateObjects)!0===a.shStateObjects[b]&&console.log("Rename "+b)};a.objectsEdit=function(){for(var b in a.shStateObjects)!0===a.shStateObjects[b]&&console.log("Edit "+b)};a.objectsDelete=function(){for(var b in a.shStateObjects)!0===a.shStateObjects[b]&&m.deleteFromList(a.shObjects[b],a.shPosts)};a.channelDelete=function(b){k.deleteFromList(b,a.shChannels)};
a.postDelete=function(b){m.deleteFromList(b,a.shPosts)}}]);
shioharaApp.controller("ShChannelEditCtrl",["$scope","$http","$window","$state","$stateParams","$rootScope","Token","shChannelResource","shSiteResource","shAPIServerService","vigLocale","$location","$translate","Notification",function(a,b,d,f,e,c,h,g,k,m,l,n,p,q){a.channelId=e.channelId;a.vigLanguage=l.getLocale().substring(0,2);p.use(a.vigLanguage);a.shSite=null;a.shParentChannel=null;a.shChannel=null;a.breadcrumb=null;c.$state=f;a.shChannel=g.get({id:a.channelId});rootChannel=!1;1==a.shChannel.rootChannel&&
(rootChannel=!0);rootChannel?a.shSite=a.shChannel.shSite:a.$evalAsync(b.get(m.get().concat("/channel/"+a.channelId+"/path")).then(function(b){a.shParentChannel=b.data.currentChannel;a.breadcrumb=b.data.breadcrumb;a.shSite=b.data.shSite}));a.channelSave=function(){a.shChannel.$update(function(){q.warning("The "+a.shChannel.name+" Channel was updated.");f.go("content.children.channel-children",{channelId:a.shChannel.id})})}}]);
shioharaApp.controller("ShChannelNewCtrl",["$scope","$http","$window","$state","$stateParams","$rootScope","Token","shChannelResource","shSiteResource","shAPIServerService","vigLocale","$location","$translate","Notification",function(a,b,d,f,e,c,h,g,k,m,l,n,p,q){a.siteId=e.siteId;a.channelId=e.channelId;rootChannel=!1;null!=a.siteId&&(rootChannel=!0);a.vigLanguage=l.getLocale().substring(0,2);p.use(a.vigLanguage);a.shSite=null;a.shParentChannel=null;a.shChannel=null;a.breadcrumb=null;c.$state=f;a.$evalAsync(b.get(m.get().concat("/channel/model")).then(function(b){a.shChannel=
b.data}));rootChannel?a.shSite=k.get({id:a.siteId}):a.$evalAsync(b.get(m.get().concat("/channel/"+a.channelId+"/path")).then(function(b){a.shParentChannel=b.data.currentChannel;a.breadcrumb=b.data.breadcrumb;a.shSite=b.data.shSite}));a.channelSave=function(){null!=a.shChannel.id&&0<a.shChannel.id?a.shChannel.$update(function(){q.warning("The "+a.shChannel.name+" Channel was created.");f.go("content.children.channel-children",{channelId:a.shChannel.id})}):(delete a.shChannel.id,rootChannel?(a.shChannel.rootChannel=
1,a.shChannel.shSite=a.shSite,g.save(a.shChannel,function(b){a.shChannel=b;q.warning("The "+a.shChannel.name+" Channel was created.");f.go("content.children.channel-children",{channelId:a.shChannel.id})})):(a.shChannel.parentChannel=a.shParentChannel,g.save(a.shChannel,function(b){a.shChannel=b;q.warning("The "+a.shChannel.name+" Channel was created.");f.go("content.children.channel-children",{channelId:a.shChannel.id})})))}}]);
shioharaApp.controller("ShComponentExplorerCtrl",["$scope","shAPIServerService","$http","$uibModalInstance","channelId","objectType","shWidgetFileFactory",function(a,b,d,f,e,c,h){var g=this;g.objectTypeName="Object";g.channelDoubleClick=!1;angular.equals(c,"shChannel")&&(g.objectTypeName="Channel",g.channelDoubleClick=!0);g.enableInsertButton=!1;null==g.shChannelSelected;g.shPostSelected=null;g.ok=function(){f.close(g.shPostSelected)};g.cancel=function(){g.shPostSelected=null;f.dismiss("cancel")};
a.shSite=null;a.shChannels=null;a.shPosts=null;a.breadcrumb=null;a.channelList=function(e){g.enableInsertButton=!1;g.shPostSelected=null;a.$evalAsync(d.get(b.get().concat("/channel/"+e+"/list/"+c)).then(function(b){a.shChannels=b.data.shChannels;a.shPosts=b.data.shPosts;a.breadcrumb=b.data.breadcrumb;a.shSite=b.data.shSite}))};a.siteList=function(c){g.shPostSelected=null;a.$evalAsync(d.get(b.get().concat("/site/"+c+"/channel")).then(function(b){a.shChannels=b.data.shChannels;a.shPosts=b.data.shPosts;
a.shSite=b.data.shSite}))};a.selectedPost=function(a){g.shPostSelected=a;g.enableInsertButton=!0};a.selectedChannel=function(a){g.shChannelSelected=a;g.enableInsertButton=!0};a.channelList(e)}]);
shioharaApp.controller("ShContentChildrenCtrl",["$scope","$http","$state","$stateParams","$rootScope","Token","shUserResource","shPostTypeResource","shAPIServerService","vigLocale","$translate","shChannelFactory","shPostFactory",function(a,b,d,f,e,c,h,g,k,m,l,n,p){a.vigLanguage=m.getLocale().substring(0,2);l.use(a.vigLanguage);a.siteId=f.siteId;a.channelId=null;a.accessToken=c.get();a.shUser=null;a.shSite=null;a.shPosts=null;a.shLastPostType=null;a.shChannels=null;e.$state=d;a.breadcrumb=null;null!=
a.siteId&&a.$evalAsync(b.get(k.get().concat("/site/"+a.siteId+"/channel")).then(function(b){a.shChannels=b.data.shChannels;a.shPosts=b.data.shPosts;a.shSite=b.data.shSite}));a.shUser=h.get({id:1,access_token:a.accessToken},function(){a.shLastPostType=g.get({id:a.shUser.lastPostType})});a.channelDelete=function(b){n.deleteFromList(b,a.shChannels)};a.postDelete=function(b){p.deleteFromList(b,a.shPosts)}}]);
shioharaApp.controller("ShContentCtrl",["$rootScope","$scope","Token","vigLocale","$translate",function(a,b,d,f,e){b.vigLanguage=f.getLocale().substring(0,2);e.use(b.vigLanguage);b.accessToken=d.get()}]);
shioharaApp.factory("ShDialogSelectObject",["$uibModal","shPostResource","Notification","$filter","$state",function(a,b,d,f,e){return{dialog:function(b,e){return a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"template/dialog/select/dialog-object-select.html",controller:"ShComponentExplorerCtrl",controllerAs:"$ctrl",size:null,appendTo:void 0,resolve:{channelId:function(){return b},objectType:function(){return e}}})}}}]);
shioharaApp.controller("ShModalDeleteObjectCtrl",["$uibModalInstance","$http","shObject","shAPIServerService","shWidgetFileFactory",function(a,b,d,f,e){var c=this;c.removeInstance=!1;c.shObject=d;shObjectType=c.shObject.shGlobalId.type;angular.equals(shObjectType,"POST")||angular.equals(shObjectType,"POSTTYPE")?c.objectName=d.title:c.objectName=d.name;b.get(f.get().concat("/reference/to/"+c.shObject.shGlobalId.id)).then(function(a){c.objectRefers=a.data});c.ok=function(){c.removeInstance=!0;a.close(c.removeInstance)};
c.cancel=function(){c.removeInstance=!1;a.dismiss("cancel")};c.selectFile=function(){e.modalSelectFile(c.shObject.shChannel.id).result.then(function(a){b.post(f.get().concat("/reference/to/"+d.shGlobalId.id+"/replace/"+a.shGlobalId.id)).then(function(a){c.objectRefers=a.data})},function(){})}}]);
shioharaApp.controller("ShOAuth2Ctrl",["$scope","$http","$window","$state","$rootScope","Token",function(a,b,d,f,e,c){a.accessToken=c.get();a.authenticate=function(){c.getTokenByPopup(a.askApproval?{approval_prompt:"force"}:{}).then(function(b){c.verifyAsync(b.access_token).then(function(d){e.$apply(function(){a.accessToken=b.access_token;a.expiresIn=b.expires_in;c.set(b.access_token)})},function(){alert("Failed to verify token.")})},function(){alert("Failed to get token from popup.")})}}]);
shioharaApp.factory("shPostFactory",["$uibModal","shPostResource","Notification","$filter","$state",function(a,b,d,f,e){return{deleteFromList:function(a,e){this.modalDelete(a).result.then(function(g){var k="The "+a.title+" Post was deleted.";b["delete"]({id:a.id},function(){var b=f("filter")(e,{id:a.id},!0)[0],b=e.indexOf(b);e.splice(b,1);d.error(k)})},function(){})},"delete":function(a){this.modalDelete(a).result.then(function(f){deletedMessage="The "+a.title+" Post was deleted.";b["delete"]({id:a.id},
function(){d.error(deletedMessage);e.go("content.children.channel-children",{channelId:a.shChannel.id})})},function(){})},modalDelete:function(b){return a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"template/modal/shDeleteObject.html",controller:"ShModalDeleteObjectCtrl",controllerAs:"$ctrl",size:null,appendTo:void 0,resolve:{shObject:function(){return b}}})}}}]);
shioharaApp.factory("shPostResource",["$resource","shAPIServerService",function(a,b){return a(b.get().concat("/post/:id"),{id:"@id"},{update:{method:"PUT"}})}]);
shioharaApp.controller("ShPostEditCtrl",["$scope","$http","$window","$stateParams","$state","$rootScope","shPostResource","shAPIServerService","Notification","Upload","$q","$timeout","shStaticFileFactory","shPostFactory",function(a,b,d,f,e,c,h,g,k,m,l,n,p,q){a.tinymceOptions={plugins:"link image code",toolbar:"undo redo | bold italic | alignleft aligncenter alignright | code"};var r=null,t=null;a.channelId=null;a.postId=f.postId;a.breadcrumb=null;a.shSite=null;a.shPost=h.get({id:a.postId},function(){null!=
a.shPost.shChannel&&(a.channelId=a.shPost.shChannel.id,a.$evalAsync(b.get(g.get().concat("/channel/"+a.channelId+"/path")).then(function(b){a.breadcrumb=b.data.breadcrumb;a.shSite=b.data.shSite;t=g.server().concat("/store/file_source/"+a.shSite.name+b.data.channelPath);r=g.server().concat("/sites/"+a.shSite.name.replace(RegExp(" ","g"),"-")+"/default/pt-br"+b.data.channelPath.replace(RegExp(" ","g"),"-"))})))});a.openPreviewURL=function(){var b="PT-FILE"==a.shPost.shPostType.name?t+a.shPost.title:
"PT-CHANNEL-INDEX"==a.shPost.shPostType.name?r:r+a.shPost.title.replace(RegExp(" ","g"),"-");d.open(b,"_self")};a.postEditForm="template/post/form.html";a.postDelete=function(){q["delete"](a.shPost)};a.postSave=function(){var b=[];a.filePath=null;a.numberOfFileWidgets=0;var e=a.shPost.shPostType;angular.forEach(a.shPost.shPostAttrs,function(c,d){b.push(p.uploadFile(a.channelId,c,d,e,a.shPost,a.numberOfFileWidgets))});l.all(b).then(function(b){a.shPost.$update(function(){k.warning("The "+a.shPost.title+
" Post was updated.")})})}}]);shioharaApp.controller("ShPostFormCtrl",["$scope","$http","$window","$stateParams","$state","$rootScope",function(a,b,d,f,e,c){a.postTypeAttrId=f.postTypeAttrId;a.shPostTypeItem=angular.copy(a.shPostType)}]);
shioharaApp.controller("ShPostNewCtrl",["$scope","$http","$window","$stateParams","$state","$rootScope","shAPIServerService","shPostResource","Notification","Upload","$q","$timeout","shStaticFileFactory",function(a,b,d,f,e,c,h,g,k,m,l,n,p){a.tinymceOptions={plugins:"link image code",toolbar:"undo redo | bold italic | alignleft aligncenter alignright | code"};a.channelId=f.channelId;a.postTypeId=f.postTypeId;a.breadcrumb=null;a.shPost=null;a.shChannel=null;var q=a.shSite=null;a.$evalAsync(b.get(h.get().concat("/channel/"+
a.channelId+"/path")).then(function(b){a.shChannel=b.data.currentChannel;a.breadcrumb=b.data.breadcrumb;a.shSite=b.data.shSite;folderPath=h.server().concat("/store/file_source/"+a.shSite.name+b.data.channelPath);q=h.server().concat("/sites/"+a.shSite.name.replace(RegExp(" ","g"),"-")+"/default/pt-br"+b.data.channelPath.replace(RegExp(" ","g"),"-"))}));a.$evalAsync(b.get(h.get().concat("/post/type/"+a.postTypeId+"/post/model")).then(function(b){a.shPost=b.data}));a.postEditForm="template/post/form.html";
a.openPreviewURL=function(){var b="PT-FILE"==a.shPost.shPostType.name?folderPath+a.shPost.title:"PT-CHANNEL-INDEX"==a.shPost.shPostType.name?q:q+a.shPost.title.replace(RegExp(" ","g"),"-");d.open(b,"_self")};a.postSave=function(){var b=[];a.filePath=null;a.numberOfFileWidgets=0;var e=a.shPost.shPostType;angular.forEach(a.shPost.shPostAttrs,function(c,d){b.push(p.uploadFile(a.channelId,c,d,e,a.shPost,a.numberOfFileWidgets))});l.all(b).then(function(b){null!=a.shPost.id?a.shPost.$update(function(){k.warning("The "+
a.shPost.title+" Post was update.")}):(delete a.shPost.id,a.shPost.shChannel=a.shChannel,g.save(a.shPost,function(b){a.shPost=b;k.warning("The "+a.shPost.title+" Post was created.")}))})}}]);shioharaApp.factory("shPostTypeAttrResource",["$resource","shAPIServerService",function(a,b){return a(b.get().concat("/post/type/attr/:id"),{id:"@id"},{update:{method:"PUT"}})}]);
shioharaApp.factory("shPostTypeResource",["$resource","shAPIServerService",function(a,b){return a(b.get().concat("/post/type/:id"),{id:"@id"},{update:{method:"PUT"}})}]);shioharaApp.controller("ShPostTypeAttrCtrl",["$scope","$http","$window","$stateParams","$state","$rootScope","shPostTypeAttrResource",function(a,b,d,f,e,c,h){a.postTypeAttrId=f.postTypeAttrId;a.shPostTypeAttr=h.get({id:a.postTypeAttrId});c.$state=e;a.postTypeAttrSave=function(){a.shshPostTypeAttrPost.$update(function(){e.go("content.post-type-item")})}}]);
shioharaApp.controller("ShPostTypeEditorCtrl",["$scope","$http","$window","$state","$rootScope","shAPIServerService","shPostTypeResource","Notification",function(a,b,d,f,e,c,h,g){e.$state=f;a.shPostType=null;a.$evalAsync(b.get(c.get().concat("/post/type/model")).then(function(b){a.shPostType=b.data}));a.postTypeSave=function(){delete a.shPostType.id;h.save(a.shPostType,function(){g.warning("The "+a.shPostType.name+" Site was created.");f.go("content.post-type-select")})}}]);
shioharaApp.controller("ShPostTypeItemCtrl",["$scope","$http","$window","$stateParams","$state","$rootScope","shWidgetResource","shPostTypeResource","shPostTypeAttrResource","shAPIServerService","Notification",function(a,b,d,f,e,c,h,g,k,m,l){a.postTypeId=f.postTypeId;a.shPostType=null;a.shWidgets=h.query();c.$state=e;a.shPostType=g.get({id:a.postTypeId},function(b){a.shPostNewItem=angular.copy(a.shPostType);for(b=0;b<a.shPostNewItem.shPostTypeAttrs.length;b++)a.shPostNewItem.shPostTypeAttrs[b].value=
"Novo Valor"+b});a.shPostTypeAttrModel=null;a.$evalAsync(b.get(m.get().concat("/post/type/attr/model")).then(function(b){a.shPostTypeAttrModel=b.data}));a.postTypeSave=function(){angular.forEach(a.shPostType.shPostTypeAttrs,function(b,e){if(1==b.willBeDeleted){k["delete"]({id:b.id});var c=a.shPostType.shPostTypeAttrs.indexOf(b);a.shPostType.shPostTypeAttrs.splice(c,1)}});a.shPostType.$update(function(){l.warning("The "+a.shPostType.name+" Site was updated.");e.go("content.post-type-select")})};a.removePostType=
function(){g["delete"]({id:a.shPostType.id},function(){l.error("The "+a.shPostType.name+" Site was deleted.");e.go("content.post-type-select")})};a.addPostTypeAttr=function(b){a.shPostTypeAttrModel.shWidget=b;delete a.shPostTypeAttrModel.id;a.shPostType.shPostTypeAttrs.push(angular.copy(a.shPostTypeAttrModel))};a.removePostTypeAttr=function(b){null==b.id||0==b.id?(b=a.shPostType.shPostTypeAttrs.indexOf(b),a.shPostType.shPostTypeAttrs.splice(b,1)):b.willBeDeleted=1}}]);
shioharaApp.controller("ShPostTypeSelectCtrl",["$scope","$http","$window","$state","$stateParams","$rootScope","shPostTypeResource","shSiteResource","shAPIServerService",function(a,b,d,f,e,c,h,g,k){c.$state=f;a.shPostTypes=h.query();a.shSite=null;a.breadcrumb=null}]);
shioharaApp.controller("ShPostTypeSelectWithChannelCtrl",["$scope","$http","$window","$state","$stateParams","$rootScope","shPostTypeResource","shSiteResource","shAPIServerService",function(a,b,d,f,e,c,h,g,k){a.siteId=e.siteId;a.channelId=e.channelId;c.$state=f;a.shPostTypes=h.query();a.shSite=null;a.breadcrumb=null;null!=a.channelId?a.$evalAsync(b.get(k.get().concat("/channel/"+a.channelId+"/path")).then(function(b){a.breadcrumb=b.data.breadcrumb;a.shSite=b.data.currentChannel.shSite})):a.shSite=
g.get({id:a.siteId})}]);
shioharaApp.factory("shSiteFactory",["$uibModal","shSiteResource","Notification","$state",function(a,b,d,f){return{"delete":function(a){this.modalDelete(a).result.then(function(b){deletedMessage="The "+a.name+" Site was deleted.";shSiteResource["delete"]({id:a.id},function(){d.error(deletedMessage);f.go("content",{},{reload:!0})})},function(){})},save:function(a){if(null!=a.id){var b="The "+a.name+" Site was saved.";a.$update(function(){d.warning(b);f.go("content.children.site-children",{siteId:a.id})})}else{var h=
"The "+a.name+" Site was updated.";delete $scope.shSite.id;shSiteResource.save(a,function(a){d.warning(h);f.go("content.children.site-children",{siteId:a.id})})}},modalDelete:function(b){return a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"template/modal/shDeleteObject.html",controller:"ShModalDeleteObjectCtrl",controllerAs:"$ctrl",size:null,appendTo:void 0,resolve:{shObject:function(){return b}}})}}}]);
shioharaApp.factory("shSiteResource",["$resource","shAPIServerService",function(a,b){return a(b.get().concat("/site/:id"),{id:"@id"},{update:{method:"PUT"}})}]);
shioharaApp.controller("ShSiteChildrenCtrl",["$scope","$http","$state","$stateParams","$rootScope","Token","shUserResource","shPostTypeResource","shAPIServerService","vigLocale","$translate","shChannelFactory","shPostFactory",function(a,b,d,f,e,c,h,g,k,m,l,n,p){a.vigLanguage=m.getLocale().substring(0,2);l.use(a.vigLanguage);a.siteId=f.siteId;a.channelId=null;a.accessToken=c.get();a.shUser=null;a.shSite=null;a.shPosts=null;a.shLastPostType=null;a.shChannels=null;e.$state=d;a.breadcrumb=null;a.$evalAsync(b.get(k.get().concat("/site/"+
a.siteId+"/channel")).then(function(b){a.shChannels=b.data.shChannels;a.shPosts=b.data.shPosts;a.shSite=b.data.shSite}));a.shUser=h.get({id:1,access_token:a.accessToken},function(){a.shLastPostType=g.get({id:a.shUser.lastPostType})});a.channelDelete=function(b){n.deleteFromList(b,a.shChannels)};a.postDelete=function(b){p.deleteFromList(b,a.shPosts)}}]);
shioharaApp.controller("ShSiteEditCtrl",["$scope","$state","$stateParams","shSiteResource","shSiteFactory",function(a,b,d,f,e){a.shSite=f.get({id:d.siteId});a.siteSave=function(){e.save(a.shSite)};a.siteDelete=function(){e["delete"](a.shSite)}}]);shioharaApp.controller("ShSiteListCtrl",["$scope","$http","$window","$state","$rootScope","shSiteResource",function(a,b,d,f,e,c){e.$state=f;a.shSites=c.query()}]);
shioharaApp.controller("ShSiteNewCtrl",["$scope","$http","shAPIServerService","shSiteFactory",function(a,b,d,f){a.shSite=null;a.$evalAsync(b.get(d.get().concat("/site/model")).then(function(b){a.shSite=b.data}));a.siteSave=function(){f.save(a.shSite)}}]);
shioharaApp.factory("shStaticFileFactory",["$q","Upload","shAPIServerService","$timeout",function(a,b,d,f){return{uploadFile:function(e,c,f,g,k,m){var l=a.defer();if("File"==c.shPostTypeAttr.shWidget.name&&null!=c.file){var n=!0;"PT-FILE"==g.name&&(n=!1);m++;file=c.file;file.$error||b.upload({url:d.get().concat("/staticfile/upload"),data:{file:file,channelId:e,createPost:n}}).then(function(a){filePath=a.data.title;n?(k.shPostAttrs[f].strValue=a.data.id,delete k.shPostAttrs[f].referenceObjects):k.shPostAttrs[f].strValue=
filePath;l.resolve("Success")},null,function(a){parseInt(100*a.loaded/a.total)})}else l.resolve("Success");return l.promise}}}]);shioharaApp.factory("shUserResource",["$resource","shAPIServerService",function(a,b){return a(b.get().concat("/user/:id"),{id:"@id"},{update:{method:"PUT"}})}]);shioharaApp.factory("shWidgetResource",["$resource","shAPIServerService",function(a,b){return a(b.get().concat("/widget/:id"),{id:"@id"},{update:{method:"PUT"}})}]);
shioharaApp.factory("shWidgetFileFactory",["$uibModal","shPostResource","Notification","$filter","$state",function(a,b,d,f,e){return{modalSelectFile:function(b){return a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"template/widget/file/file-select.html",controller:"ShWidgetFileSelectCtrl",controllerAs:"$ctrl",size:null,appendTo:void 0,resolve:{channelId:function(){return b}}})}}}]);
shioharaApp.controller("ShWidgetFileCtrl",["$scope","Upload","$timeout","$uibModal","shWidgetFileFactory",function(a,b,d,f,e){a.fileName=null;a.uploadNewFile=!1;a.$watch("shPostAttr.file",function(){null!=a.shPostAttr.file&&(a.uploadNewFile=!1,a.fileName=a.shPostAttr.file.name,a.shPostAttr.strValue=a.fileName)});a.newFile=function(){a.uploadNewFile=!0};a.clearFile=function(a){a.strValue=null;a.file=null};a.selectFile=function(b,d){e.modalSelectFile(a.channelId).result.then(function(b){a.uploadNewFile=
!1;a.fileName=b.title;d.strValue=b.id;d.referenceObjects=[b]},function(){})}}]);
shioharaApp.controller("ShWidgetFileSelectCtrl",["$scope","shAPIServerService","$http","$uibModalInstance","channelId","shWidgetFileFactory",function(a,b,d,f,e,c){var h=this;h.shPostSelected=null;h.ok=function(){f.close(h.shPostSelected)};h.cancel=function(){h.shPostSelected=null;f.dismiss("cancel")};a.shSite=null;a.shChannels=null;a.shPosts=null;a.breadcrumb=null;a.channelList=function(c){h.shPostSelected=null;a.$evalAsync(d.get(b.get().concat("/channel/"+c+"/list/PT-FILE")).then(function(b){a.shChannels=
b.data.shChannels;a.shPosts=b.data.shPosts;a.breadcrumb=b.data.breadcrumb;a.shSite=b.data.shSite}))};a.siteList=function(c){h.shPostSelected=null;a.$evalAsync(d.get(b.get().concat("/site/"+c+"/channel")).then(function(b){a.shChannels=b.data.shChannels;a.shPosts=b.data.shPosts;a.shSite=b.data.shSite}))};a.selectedPost=function(a){h.shPostSelected=a};a.channelList(e)}]);