var shioharaApp=angular.module("shioharaApp","ngCookies ngResource ngAnimate ngSanitize ui.router ui.bootstrap pascalprecht.translate vecchioOauth angularMoment ui.ace".split(" "));
shioharaApp.config(["$stateProvider","$urlRouterProvider","TokenProvider","$locationProvider","$translateProvider",function(a,b,g,d,c){g.extendConfig({clientId:"b0ec29dd6e0c6bd98b37fee1799dc0a8",redirectUri:"http://localhost:8080/oauth2callback.html",scopes:["https://www.googleapis.com/auth/userinfo.email"]});c.useSanitizeValueStrategy("escaped");c.translations("en",{SEARCH:"Search",SEARCH_FOR:"Search for"});c.translations("pt",{SEARCH:"Pesquisar",SEARCH_FOR:"Pesquisar por"});c.fallbackLanguage("en");
b.otherwise("/content/list/site/1");a.state("oauth2",{url:"/oauth2",templateUrl:"template/oauth2.html",controller:"ShOAuth2Ctrl",data:{pageTitle:"OAuth2 | Viglet Shiohara"}}).state("content",{url:"/content",templateUrl:"template/content.html",controller:"ShContentCtrl",data:{pageTitle:"Content | Viglet Shiohara"}}).state("content.children",{url:"/list",templateUrl:"template/content/content-children.html",controller:"ShContentChildrenCtrl",data:{pageTitle:"Content | Viglet Shiohara"}}).state("content.children.site-children",
{url:"/site/:siteId",templateUrl:"template/site/site-children.html",controller:"ShSiteChildrenCtrl",data:{pageTitle:"Content | Viglet Shiohara"}}).state("content.children.channel-children",{url:"/channel/:channelId",templateUrl:"template/channel/channel-children.html",controller:"ShChannelChildrenCtrl",data:{pageTitle:"Content | Viglet Shiohara"}}).state("content.post-type-editor",{url:"/post/type/editor",templateUrl:"template/post/type/editor.html",controller:"ShPostTypeEditorCtrl",data:{pageTitle:"Post Type Editor | Viglet Shiohara"}}).state("content.post-type-item",
{url:"/post/type/:postTypeId",templateUrl:"template/post/type/item.html",controller:"ShPostTypeItemCtrl",data:{pageTitle:"Post Type Editor | Viglet Shiohara"}}).state("content.post-type-item.attribute",{url:"/attrib/:postTypeAttrId",templateUrl:"template/post/type/attribute.html",controller:"ShPostTypeAttrCtrl",data:{pageTitle:"Post Type Editor | Viglet Shiohara"}}).state("content.post-type-item.post-item-new",{url:"/channel/:channelId",templateUrl:"template/post/item.html",controller:"ShPostNewCtrl",
data:{pageTitle:"New Post | Viglet Shiohara"}}).state("content.post-type-item.post-item",{url:"/post/:postId",templateUrl:"template/post/item.html",controller:"ShPostEditCtrl",data:{pageTitle:"New Post | Viglet Shiohara"}}).state("post-item-form",{url:"/post/type/:postTypeId/post/form",templateUrl:"template/post/form.html",controller:"ShPostFormCtrl",data:{}}).state("content.channel",{url:"/channel/:channelId"}).state("content.site",{url:"/site/:siteId"}).state("content.channel.channel-new",{url:"/channel",
templateUrl:"template/channel/channel-new.html",controller:"ShChannelNewCtrl",data:{pageTitle:"New Channel | Viglet Shiohara"}}).state("content.site.channel-new",{url:"/channel",templateUrl:"template/channel/channel-new.html",controller:"ShChannelNewCtrl",data:{pageTitle:"New Channel | Viglet Shiohara"}}).state("content.channel.post-type-select",{url:"/post/type",templateUrl:"template/post/type/select.html",controller:"ShPostTypeSelectCtrl",data:{pageTitle:"Post Type Selection | Viglet Shiohara"}}).state("content.site.post-type-select",
{url:"/post/type",templateUrl:"template/post/type/select.html",controller:"ShPostTypeSelectCtrl",data:{pageTitle:"Post Type Selection | Viglet Shiohara"}})}]);
shioharaApp.service("shAPIServerService",["$http","$location","$cookies",function(a,b,g){var d=b.protocol(),c=b.host();b=b.port();var f=d+"://"+c+":"+b,e=f+"/api";console.log(f);this.server=function(){if(null!=g.get("shServer"))return g.get("shServer");a({method:"GET",url:e}).then(function(a){g.put("shServer",f)},function(a){g.put("shServer","http://localhost:2710")});return f};this.get=function(){if(null!=g.get("shAPIServer"))return g.get("shAPIServer");a({method:"GET",url:e}).then(function(a){g.put("shAPIServer",
e)},function(a){g.put("shAPIServer","http://localhost:2710/api")});return e}}]);shioharaApp.factory("vigLocale",["$window",function(a){return{getLocale:function(){var b=a.navigator;return angular.isArray(b.languages)&&0<b.languages.length?b.languages[0].split("-").join("_"):(b.language||b.browserLanguage||b.systemLanguage||b.userLanguage||"").split("-").join("_")}}}]);
shioharaApp.controller("ShContentCtrl",["$rootScope","$scope","Token","vigLocale","$translate",function(a,b,g,d,c){b.vigLanguage=d.getLocale().substring(0,2);c.use(b.vigLanguage);b.accessToken=g.get()}]);shioharaApp.controller("ShPostFormCtrl",["$scope","$http","$window","$stateParams","$state","$rootScope",function(a,b,g,d,c,f){a.postTypeAttrId=d.postTypeAttrId;a.shPostTypeItem=angular.copy(a.shPostType)}]);
shioharaApp.controller("ShPostTypeAttrCtrl",["$scope","$http","$window","$stateParams","$state","$rootScope","shPostTypeAttrResource",function(a,b,g,d,c,f,e){a.postTypeAttrId=d.postTypeAttrId;a.shPostTypeAttr=e.get({id:a.postTypeAttrId});f.$state=c;a.postTypeAttrSave=function(){a.shshPostTypeAttrPost.$update(function(){c.go("content.post-type-item")})}}]);
shioharaApp.controller("ShPostTypeSelectCtrl",["$scope","$http","$window","$state","$stateParams","$rootScope","shPostTypeResource","shSiteResource","shAPIServerService",function(a,b,g,d,c,f,e,h,l){a.siteId=c.siteId;a.channelId=c.channelId;f.$state=d;a.shPostTypes=e.query();a.shSite=null;a.breadcrumb=null;null!=a.channelId?a.$evalAsync(b.get(l.get().concat("/channel/"+a.channelId+"/path")).then(function(b){a.breadcrumb=b.data.breadcrumb;a.shSite=b.data.currentChannel.shSite})):a.shSite=h.get({id:a.siteId})}]);
shioharaApp.controller("ShPostTypeEditorCtrl",["$scope","$http","$window","$state","$rootScope","shAPIServerService","shPostTypeResource",function(a,b,g,d,c,f,e){c.$state=d;a.shPostType=null;a.$evalAsync(b.get(f.get().concat("/post/type/model")).then(function(b){a.shPostType=b.data}));a.postTypeSave=function(){delete a.shPostType.id;e.save(a.shPostType,function(){d.go("content.post-type-select")})}}]);
shioharaApp.controller("ShPostTypeItemCtrl",["$scope","$http","$window","$stateParams","$state","$rootScope","shWidgetResource","shPostTypeResource","shPostTypeAttrResource","shAPIServerService",function(a,b,g,d,c,f,e,h,l,k){a.postTypeId=d.postTypeId;a.shPostType=null;a.shWidgets=e.query();f.$state=c;a.shPostType=h.get({id:a.postTypeId},function(b){a.shPostNewItem=angular.copy(a.shPostType);for(b=0;b<a.shPostNewItem.shPostTypeAttrs.length;b++)a.shPostNewItem.shPostTypeAttrs[b].value="Novo Valor"+
b});a.shPostTypeAttrModel=null;a.$evalAsync(b.get(k.get().concat("/post/type/attr/model")).then(function(b){a.shPostTypeAttrModel=b.data}));a.postTypeSave=function(){angular.forEach(a.shPostType.shPostTypeAttrs,function(b,c){if(1==b.willBeDeleted){l["delete"]({id:b.id});var e=a.shPostType.shPostTypeAttrs.indexOf(b);a.shPostType.shPostTypeAttrs.splice(e,1)}});a.shPostType.$update(function(){c.go("content.post-type-select")})};a.removePostType=function(){h["delete"]({id:a.shPostType.id},function(){c.go("content.post-type-select")})};
a.addPostTypeAttr=function(b){a.shPostTypeAttrModel.shWidget=b;delete a.shPostTypeAttrModel.id;a.shPostType.shPostTypeAttrs.push(angular.copy(a.shPostTypeAttrModel))};a.removePostTypeAttr=function(b){null==b.id||0==b.id?(b=a.shPostType.shPostTypeAttrs.indexOf(b),a.shPostType.shPostTypeAttrs.splice(b,1)):b.willBeDeleted=1}}]);shioharaApp.factory("shPostTypeAttrResource",["$resource","shAPIServerService",function(a,b){return a(b.get().concat("/post/type/attr/:id"),{id:"@id"},{update:{method:"PUT"}})}]);
shioharaApp.factory("shPostTypeResource",["$resource","shAPIServerService",function(a,b){return a(b.get().concat("/post/type/:id"),{id:"@id"},{update:{method:"PUT"}})}]);
shioharaApp.controller("ShPostNewCtrl",["$scope","$http","$window","$stateParams","$state","$rootScope","shAPIServerService","shPostResource",function(a,b,g,d,c,f,e,h){a.channelId=d.channelId;a.postTypeId=d.postTypeId;a.breadcrumb=null;a.shPost=null;a.shChannel=null;a.shSite=null;a.$evalAsync(b.get(e.get().concat("/channel/"+a.channelId+"/path")).then(function(b){a.shChannel=b.data.currentChannel;a.breadcrumb=b.data.breadcrumb;a.shSite=b.data.currentChannel.shSite}));a.$evalAsync(b.get(e.get().concat("/post/type/"+
a.postTypeId+"/post/model")).then(function(b){a.shPost=b.data}));a.postEditForm="template/post/form.html";a.openPreviewURL=function(){if(null!=a.shPost.shChannel)a.$evalAsync(b.get(e.get().concat("/channel/"+a.shPost.shChannel.id+"/path")).then(function(b){b="PT-CHANNEL-INDEX"==a.shPost.shPostType.name?e.server().concat("/sites/SampleSite/default/pt-br"+b.data.channelPath.replace(RegExp(" ","g"),"-")):e.server().concat("/sites/SampleSite/default/pt-br"+b.data.channelPath.replace(RegExp(" ","g"),"-")+
a.shPost.title.replace(RegExp(" ","g"),"-"));g.open(b,"_self")}));else{var c="PT-CHANNEL-INDEX"==a.shPost.shPostType.name?e.server().concat("/sites/SampleSite/default/pt-br"+response.data.channelPath.replace(RegExp(" ","g"),"-")):e.server().concat("/sites/SampleSite/default/pt-br/"+a.shPost.title.replace(RegExp(" ","g"),"-"));g.open(c,"_self")}};a.postSave=function(){null!=a.shPost.id&&0<a.shPost.id?a.shPost.$update(function(){}):(delete a.shPost.id,a.shPost.shChannel=a.shChannel,h.save(a.shPost,
function(b){console.log(b);a.shPost=b}))}}]);shioharaApp.factory("shPostResource",["$resource","shAPIServerService",function(a,b){return a(b.get().concat("/post/:id"),{id:"@id"},{update:{method:"PUT"}})}]);
shioharaApp.controller("ShPostEditCtrl",["$scope","$http","$window","$stateParams","$state","$rootScope","shPostResource","shAPIServerService",function(a,b,g,d,c,f,e,h){a.postId=d.postId;a.breadcrumb=null;a.shSite=null;a.shPost=e.get({id:a.postId},function(){null!=a.shPost.shChannel&&a.$evalAsync(b.get(h.get().concat("/channel/"+a.shPost.shChannel.id+"/path")).then(function(b){a.breadcrumb=b.data.breadcrumb;a.shSite=b.data.currentChannel.shSite}))});a.openPreviewURL=function(){if(null!=a.shPost.shChannel)a.$evalAsync(b.get(h.get().concat("/channel/"+
a.shPost.shChannel.id+"/path")).then(function(b){b="PT-CHANNEL-INDEX"==a.shPost.shPostType.name?h.server().concat("/sites/SampleSite/default/pt-br"+b.data.channelPath.replace(RegExp(" ","g"),"-")):h.server().concat("/sites/SampleSite/default/pt-br"+b.data.channelPath.replace(RegExp(" ","g"),"-")+a.shPost.title.replace(RegExp(" ","g"),"-"));g.open(b,"_self")}));else{var c="PT-CHANNEL-INDEX"==a.shPost.shPostType.name?h.server().concat("/sites/SampleSite/default/pt-br"+response.data.channelPath.replace(RegExp(" ",
"g"),"-")):h.server().concat("/sites/SampleSite/default/pt-br/"+a.shPost.title.replace(RegExp(" ","g"),"-"));g.open(c,"_self")}};a.postEditForm="template/post/form.html";a.postDelete=function(){e["delete"]({id:a.shPost.id},function(){c.go("content",{},{reload:!0})})};a.postSave=function(){a.shPost.$update(function(){})}}]);shioharaApp.factory("shWidgetResource",["$resource","shAPIServerService",function(a,b){return a(b.get().concat("/widget/:id"),{id:"@id"},{update:{method:"PUT"}})}]);
shioharaApp.controller("ShOAuth2Ctrl",["$scope","$http","$window","$state","$rootScope","Token",function(a,b,g,d,c,f){a.accessToken=f.get();a.authenticate=function(){f.getTokenByPopup(a.askApproval?{approval_prompt:"force"}:{}).then(function(b){f.verifyAsync(b.access_token).then(function(d){c.$apply(function(){a.accessToken=b.access_token;a.expiresIn=b.expires_in;f.set(b.access_token)})},function(){alert("Failed to verify token.")})},function(){alert("Failed to get token from popup.")})}}]);
shioharaApp.controller("ShContentChildrenCtrl",["$scope","$http","$window","$state","$stateParams","$rootScope","Token","shUserResource","shSiteResource","shChannelResource","shPostTypeResource","shPostResource","shAPIServerService","vigLocale","$location","$translate","$filter",function(a,b,g,d,c,f,e,h,l,k,n,p,m,t,u,q,r){a.vigLanguage=t.getLocale().substring(0,2);q.use(a.vigLanguage);a.siteId=c.siteId;a.channelId=0;a.accessToken=e.get();a.shUser=null;a.shSite=null;a.shPosts=null;a.shLastPostType=
null;a.shChannels=null;f.$state=d;a.breadcrumb=null;null!=a.siteId&&a.$evalAsync(b.get(m.get().concat("/site/"+a.siteId+"/channel")).then(function(b){a.shChannels=b.data.shChannels;a.shPosts=b.data.shPosts;a.shSite=b.data.shSite}));a.shUser=h.get({id:1,access_token:a.accessToken},function(){a.shLastPostType=n.get({id:a.shUser.lastPostType})});a.channelDelete=function(b){k["delete"]({id:b},function(){var c=r("filter")(a.shChannels,{id:b},!0)[0],c=a.shChannels.indexOf(c);a.shChannels.splice(c,1)})};
a.postDelete=function(b){p["delete"]({id:b},function(){var c=r("filter")(a.shPosts,{id:b},!0)[0],c=a.shPosts.indexOf(c);a.shPosts.splice(c,1)})}}]);shioharaApp.factory("shUserResource",["$resource","shAPIServerService",function(a,b){return a(b.get().concat("/user/:id"),{id:"@id"},{update:{method:"PUT"}})}]);
shioharaApp.controller("ShChannelNewCtrl",["$scope","$http","$window","$state","$stateParams","$rootScope","Token","shChannelResource","shSiteResource","shAPIServerService","vigLocale","$location","$translate",function(a,b,g,d,c,f,e,h,l,k,n,p,m){a.siteId=c.siteId;a.channelId=c.channelId;rootChannel=!1;null!=a.siteId&&(rootChannel=!0);a.vigLanguage=n.getLocale().substring(0,2);m.use(a.vigLanguage);a.shSite=null;a.shParentChannel=null;a.shChannel=null;a.breadcrumb=null;f.$state=d;a.$evalAsync(b.get(k.get().concat("/channel/model")).then(function(b){a.shChannel=
b.data}));rootChannel?a.shSite=l.get({id:a.siteId}):a.$evalAsync(b.get(k.get().concat("/channel/"+a.channelId+"/path")).then(function(b){a.shParentChannel=b.data.currentChannel;a.breadcrumb=b.data.breadcrumb;a.shSite=b.data.currentChannel.shSite}));a.channelSave=function(){null!=a.shChannel.id&&0<a.shChannel.id?a.shChannel.$update(function(){}):(delete a.shChannel.id,rootChannel?(a.shChannel.rootChannel=1,a.shChannel.shSite=a.shSite,h.save(a.shChannel,function(b){a.shChannel=b})):(a.shChannel.parentChannel=
a.shParentChannel,h.save(a.shChannel,function(b){a.shChannel=b})))}}]);
shioharaApp.controller("ShChannelChildrenCtrl",["$scope","$http","$window","$state","$stateParams","$rootScope","Token","shUserResource","shChannelResource","shPostResource","shPostTypeResource","shAPIServerService","vigLocale","$location","$translate","$filter",function(a,b,g,d,c,f,e,h,l,k,n,p,m,t,u,q){a.siteId=c.siteId;a.channelId=c.channelId;a.$parent.channelId=c.channelId;a.vigLanguage=m.getLocale().substring(0,2);u.use(a.vigLanguage);a.shChannels=null;a.shPosts=null;a.breadcrumb=null;f.$state=
d;a.$evalAsync(b.get(p.get().concat("/channel/"+a.channelId+"/list")).then(function(b){a.shChannels=b.data.shChannels;a.shPosts=b.data.shPosts;a.breadcrumb=b.data.breadcrumb;a.$parent.breadcrumb=b.data.breadcrumb;a.$parent.shSite=b.data.shSite}));a.channelDelete=function(b){l["delete"]({id:b},function(){var c=q("filter")(a.shChannels,{id:b},!0)[0],c=a.shChannels.indexOf(c);a.shChannels.splice(c,1)})};a.postDelete=function(b){k["delete"]({id:b},function(){var c=q("filter")(a.shPosts,{id:b},!0)[0],
c=a.shPosts.indexOf(c);a.shPosts.splice(c,1)})}}]);shioharaApp.factory("shChannelResource",["$resource","shAPIServerService",function(a,b){return a(b.get().concat("/channel/:id"),{id:"@id"},{update:{method:"PUT"}})}]);shioharaApp.controller("ShSiteListCtrl",["$scope","$http","$window","$state","$rootScope","shSiteResource",function(a,b,g,d,c,f){c.$state=d;a.shSites=f.query()}]);
shioharaApp.controller("ShSiteChildrenCtrl",["$scope","$http","$window","$state","$stateParams","$rootScope","Token","shUserResource","shSiteResource","shChannelResource","shPostTypeResource","shPostResource","shAPIServerService","vigLocale","$location","$translate","$filter",function(a,b,g,d,c,f,e,h,l,k,n,p,m,t,u,q,r){a.vigLanguage=t.getLocale().substring(0,2);q.use(a.vigLanguage);a.siteId=c.siteId;a.channelId=0;a.accessToken=e.get();a.shUser=null;a.shSite=null;a.shPosts=null;a.shLastPostType=null;
a.shChannels=null;f.$state=d;a.breadcrumb=null;a.$evalAsync(b.get(m.get().concat("/site/"+a.siteId+"/channel")).then(function(b){a.shChannels=b.data.shChannels;a.shPosts=b.data.shPosts;a.shSite=b.data.shSite}));a.shUser=h.get({id:1,access_token:a.accessToken},function(){a.shLastPostType=n.get({id:a.shUser.lastPostType})});a.channelDelete=function(b){k["delete"]({id:b},function(){var c=r("filter")(a.shChannels,{id:b},!0)[0],c=a.shChannels.indexOf(c);a.shChannels.splice(c,1)})};a.postDelete=function(b){p["delete"]({id:b},
function(){var c=r("filter")(a.shPosts,{id:b},!0)[0],c=a.shPosts.indexOf(c);a.shPosts.splice(c,1)})}}]);shioharaApp.factory("shSiteResource",["$resource","shAPIServerService",function(a,b){return a(b.get().concat("/site/:id"),{id:"@id"},{update:{method:"PUT"}})}]);